# 消息通知功能测试指南

## 🎯 测试目标
验证消息通知功能是否正常工作，包括点赞、评论、收藏三种类型的消息通知。

## 📋 测试前准备

### 1. 云函数上传（必须）
在微信开发者工具中上传以下5个云函数：
- `getMessages` - 获取消息列表
- `getUnreadMessageCount` - 获取未读消息数量  
- `markMessagesAsRead` - 标记消息为已读
- `deleteMessage` - 删除单条消息
- `clearAllMessages` - 清空所有消息

### 2. 修改过的云函数上传（必须）
- `vote` - 点赞云函数（已添加消息创建逻辑）
- `addComment` - 评论云函数（已添加消息创建逻辑）
- `getMyProfileData` - 个人资料云函数（已添加收藏消息创建逻辑）

### 3. 数据库集合创建（必须）
在微信开发者工具 → 云开发 → 数据库中创建：
- 集合名称：`messages`
- 权限设置：所有用户可读，仅创建者可写

## 🧪 测试流程

### 测试场景1：点赞消息通知

#### 步骤：
1. 使用账号A登录小程序
2. 发布一条测试帖子
3. 使用账号B登录小程序  
4. 找到账号A发布的帖子
5. 点击点赞按钮
6. 切换回账号A
7. 进入"我的"页面 → 点击"消息通知"

#### 预期结果：
- 账号A的消息列表中显示："[账号B昵称] 点赞了你的帖子"
- 消息类型显示为"👍 点赞"
- 消息标记为未读（有红点标识）
- 个人主页抽屉菜单显示未读消息数量

### 测试场景2：评论消息通知

#### 步骤：
1. 使用账号A登录小程序
2. 发布一条测试帖子
3. 使用账号B登录小程序
4. 找到账号A发布的帖子
5. 在评论区发表评论
6. 切换回账号A
7. 进入"消息通知"页面

#### 预期结果：
- 账号A的消息列表中显示："[账号B昵称] 评论了你的帖子"
- 消息类型显示为"💬 评论"
- 消息标记为未读
- 点击消息可以跳转到对应帖子

### 测试场景3：回复评论消息通知

#### 步骤：
1. 使用账号A登录小程序
2. 在任意帖子下发表评论
3. 使用账号B登录小程序
4. 找到账号A的评论
5. 点击"回复"按钮
6. 输入回复内容并发送
7. 切换回账号A
8. 进入"消息通知"页面

#### 预期结果：
- 账号A的消息列表中显示："[账号B昵称] 回复了你的评论"
- 消息类型显示为"💬 评论"
- 消息标记为未读

### 测试场景4：收藏消息通知

#### 步骤：
1. 使用账号A登录小程序
2. 发布一条测试帖子
3. 使用账号B登录小程序
4. 找到账号A发布的帖子
5. 点击收藏按钮（选择收藏夹）
6. 切换回账号A
7. 进入"消息通知"页面

#### 预期结果：
- 账号A的消息列表中显示："[账号B昵称] 收藏了你的帖子"
- 消息类型显示为"⭐ 收藏"
- 消息标记为未读

### 测试场景5：消息已读功能

#### 步骤：
1. 确保有未读消息（红点标识）
2. 点击消息进入详情页
3. 返回消息列表页面

#### 预期结果：
- 已点击的消息不再显示红点
- 未读消息数量相应减少

### 测试场景6：消息删除功能

#### 步骤：
1. 在消息列表中，找到任意消息
2. 点击消息右侧的"删除"按钮
3. 确认删除

#### 预期结果：
- 消息从列表中消失
- 页面自动刷新

### 测试场景7：清空所有消息

#### 步骤：
1. 在消息列表页面顶部，点击"清空"按钮
2. 确认清空操作

#### 预期结果：
- 所有消息被删除
- 显示空状态图标和文字

### 测试场景8：消息分类筛选

#### 步骤：
1. 在消息列表页面顶部，点击不同标签：
   - "全部" - 显示所有类型消息
   - "点赞" - 只显示点赞消息
   - "评论" - 只显示评论消息
   - "收藏" - 只显示收藏消息

#### 预期结果：
- 每个标签只显示对应类型的消息
- 标签下方有下划线指示当前选中状态

## 🔍 边界条件测试

### 测试场景9：自己给自己点赞/评论/收藏

#### 预期结果：
- 【当前测试版本】会收到自己的消息通知（方便测试）
- 【正式版本】不会收到自己的消息通知（已注释掉过滤逻辑）

### 测试场景10：重复操作

#### 步骤：
1. 对同一帖子多次点赞/取消点赞
2. 多次收藏同一帖子

#### 预期结果：
- 每次点赞都会生成新的消息
- 重复收藏不会生成消息（已有收藏记录）

### 测试场景11：消息跳转功能

#### 步骤：
1. 点击任意消息（非删除区域）

#### 预期结果：
- 跳转到对应的帖子详情页
- 消息自动标记为已读

## ⚠️ 常见问题排查

### 问题1：没有收到消息通知
- 检查云函数是否上传成功
- 检查 `messages` 集合是否创建
- 检查网络连接是否正常
- 查看云函数日志是否有错误

### 问题2：消息列表为空
- 确认有相关操作（点赞/评论/收藏）
- 检查操作是否成功
- 确认是不同用户之间的操作

### 问题3：消息数量不正确
- 刷新页面重新获取
- 检查是否有删除操作未同步

## 📱 UI界面验证点

1. **消息列表页面**：
   - 顶部标题和清空按钮
   - 四个分类标签（全部/点赞/评论/收藏）
   - 消息卡片样式（头像、类型图标、内容、时间）
   - 未读消息红点标识
   - 删除按钮

2. **空状态**：
   - 空消息图标显示
   - "暂无消息通知"文字

3. **个人主页**：
   - 抽屉菜单中"消息通知"入口
   - 未读消息数量徽章

## 🎉 测试完成标准

- ✅ 所有8个测试场景都通过
- ✅ 边界条件处理正确
- ✅ UI界面显示正常
- ✅ 消息跳转功能正常
- ✅ 已读/未读状态切换正常
- ✅ 删除和清空功能正常

完成以上测试后，消息通知功能就基本可靠了！