# 回车键小程序

一个基于微信云开发的社交内容分享平台，支持诗歌创作、图片分享、用户互动等功能。

## 最近更新

### 2024年收藏页面优化
- **修复文字换行问题**：仿照首页广场页面，为收藏页面和profile页面的收藏部分添加`white-space: pre-wrap;`样式，确保文字正确换行显示
- **修复匿名用户显示问题**：修复云函数中的语法错误，确保收藏时正确保存作者信息，获取收藏数据时能正确显示作者姓名和头像
- **完善收藏体验**：统一收藏页面的显示效果，与首页广场页面保持一致的用户体验

### 2024年字数限制优化
- **放宽帖子字数限制**：将发布帖子的字数限制从默认限制放宽到1500字，满足用户发布更长内容的需求
- **添加字数统计显示**：在发布页面添加实时字数统计，显示"当前字数/1500"格式
- **优化输入体验**：为标题输入框设置50字限制，为评论输入框设置200字限制，提供更好的输入体验
- **完善字数提示**：通过maxlength属性确保用户了解字数限制，避免发布时才发现超限

### 2024年UI图标优化
- **重新设计tab图标系统**：将tab图标改为market（广场）、road（路）、mountain（山）、pools（湖），每个都有点击与未点击两种状态
- **完善tab结构**：保持4个tab的完整结构，包括广场、路、山、湖
- **统一图标风格**：所有tab图标使用统一的命名规范和视觉风格

### 2024年开屏预加载优化
- **修复图片路径问题**：将所有本地图片的相对路径改为绝对路径，解决"file not found"错误
- **统一云函数数据字段**：修复splash.js和poem.js中数据字段不一致问题，统一使用posts字段
- **优化预加载机制**：使用wx.downloadFile替代wx.getImageInfo，实现更可靠的图片预加载
- **Promise.all优化时机**：使用Promise.all等待所有预加载任务完成，避免固定setTimeout的弊端
- **全局预加载缓存**：创建app.globalData.preloadedImages全局缓存，实现开屏和poem页面无缝衔接
- **智能跳转机制**：预加载完成后立即跳转，实现"最快加载，无缝跳转"的理想效果
- **修复Promise链条断裂**：解决preloadFirstPostImages异步任务未等待完成就跳转的关键bug
- **移除svg预加载**：小程序不支持svg格式，移除相关预加载避免错误
- **完善异步流程**：使用async/await确保图片下载完成后再跳转，彻底解决闪烁问题
- **修复onLoad与onShow冲突**：使用isFirstLoad标志位避免预加载数据被onShow强制清空
- **解决骨架屏闪烁**：首次加载时onShow跳过刷新逻辑，保持预加载数据，实现真正秒开

### 2024年mountain页面双图层背景优化
- **实现双图层背景切换**：采用两个image标签实现真正的交叉淡入淡出效果，替代无效的background-image过渡
- **独立内容数据管理**：使用currentPost对象替代postList[currentPostIndex]，避免整个卡片重新渲染
- **极致流畅切换体验**：通过opacity透明度控制实现平滑过渡，视觉上更加高级自然
- **性能优化提升**：减少小程序渲染开销，在低端机型上表现更佳
- **代码结构优化**：将updatePostDisplay和switchBackgroundImage逻辑分离，代码更清晰易维护
- **预加载机制保留**：继续使用wx.downloadFile预加载图片到本地，确保切换瞬间完成
- **修复onLoad与onShow冲突**：使用isFirstLoad标志位避免预加载数据被onShow强制清空
- **全局预加载缓存支持**：支持使用开屏预加载的图片缓存，实现无缝衔接

### 2024年poem页面双图层背景优化
- **实现双图层背景切换**：采用两个image标签实现真正的交叉淡入淡出效果，替代无效的background-image过渡
- **独立内容数据管理**：使用currentPost对象替代postList[currentPostIndex]，避免整个卡片重新渲染
- **极致流畅切换体验**：通过opacity透明度控制实现平滑过渡，视觉上更加高级自然
- **性能优化提升**：减少小程序渲染开销，在低端机型上表现更佳
- **代码结构优化**：将updatePostDisplay和switchBackgroundImage逻辑分离，代码更清晰易维护
- **预加载机制保留**：继续使用wx.downloadFile预加载图片到本地，确保切换瞬间完成

### 2024年开屏页面优化
- **修复开屏页面显示问题**：解决小程序启动时直接跳转到poem页面而不显示开屏页面的问题
- **优化页面跳转逻辑**：将自动登录逻辑从app.js移到开屏页面，确保开屏页面正常显示
- **修复图片路径问题**：更正开屏图片的引用路径，确保图片正常加载
- **智能跳转机制**：开屏页面根据用户登录状态智能跳转到相应页面（已登录跳转poem页面，未登录跳转登录页面）
- **预加载优化**：在开屏期间预加载poem页面数据，实现秒开体验
- **平滑切换动画**：添加开屏到poem页面的淡出缩放动画，提升用户体验
- **全屏显示修复**：修复开屏页面左侧缝隙问题，实现完美全屏显示

### 2024年背景切换优化
- **简化背景切换方案**：采用业内标准的双层背景图叠加方案，替代复杂的双缓冲机制
- **优化切换逻辑**：使用简单的opacity过渡，先设置下一张背景图，再切换当前背景图
- **提升过渡效果**：将过渡时间调整为0.5s，使用ease-in-out缓动函数，确保切换更加平滑自然

### 2024年性能优化更新
- **代码清理优化**：移除大量测试代码和调试信息，删除临时文件，提升运行效率
- **背景图显示优化**：poem和mountain页面统一使用压缩图作为背景，避免加载原图，减少流量消耗
- **图片压缩算法加强**：提升压缩率，质量降低到65%，尺寸限制到600px，使用webp格式，大幅减小文件体积
- **预加载机制优化**：精简预加载逻辑，只预加载必要图片，减少内存占用和网络请求
- **云函数性能提升**：清理云函数调试代码，减少不必要的日志输出，提升执行速度

### 2024年功能更新
- **个人中心收藏显示**：在个人中心添加收藏标签，可查看所有收藏内容，按时间排序
- **收藏作者信息修复**：修复收藏列表显示"匿名用户"的问题，正确显示作者姓名和头像
- **用户个人主页功能**：点击头像可进入用户个人主页，查看TA的帖子和个性签名
- **独立用户主页页面**：创建专门的用户主页页面，提供更好的浏览体验

## 参考文档

- [云开发文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)

