<!--pages/favorite-content/favorite-content.wxml-->
<view class="container">
  <!-- åˆå§‹åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading && favorites.length === 0}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- æ”¶è—å†…å®¹åˆ—è¡¨ -->
  <view wx:elif="{{favorites.length > 0}}" class="favorites-container">
    <view 
      wx:for="{{favorites}}" 
      wx:key="_id" 
      wx:for-index="index"
      class="post-item-wrapper {{item.isOriginal ? 'original-post' : ''}}"
    >
      <!-- ä½œè€…ä¿¡æ¯ -->
      <view class="author-info-outside">
        <image wx:if="{{item.postAuthorAvatar}}" 
               class="author-avatar" 
               src="{{item.postAuthorAvatar}}" 
               mode="aspectFill" 
               binderror="onAvatarError" 
               bindload="onAvatarLoad" 
               data-postindex="{{index}}" 
               catch:tap="navigateToUserProfile" 
               data-user-id="{{item.postAuthorOpenid}}" />
        <text class="author-name">{{item.postAuthorName}}</text>
      </view>
      
      <!-- å¯ç‚¹å‡»çš„å†…å®¹åŒºåŸŸ - è·³è½¬åˆ°è¯¦æƒ…é¡µ -->
      <navigator 
        class="post-content-navigator"
        url="/pages/post-detail/post-detail?id={{item.postId}}"
        hover-class="navigator-hover"
      >
        <view class="post-item">
          <view class="post-title">{{item.postTitle}}</view>
          <!-- è¯—æ­Œä½œè€…ä¿¡æ¯ -->
          <view wx:if="{{item.postIsPoem && item.postAuthor}}" class="poem-author">{{item.postAuthor}}</view>
          
          <!-- å›¾ç‰‡æ˜¾ç¤ºé€»è¾‘ (å·²ä¼˜åŒ–ï¼Œä½¿ç”¨ imageStyle å ä½) -->
          <view wx:if="{{(item.imageUrls && item.imageUrls.length > 0)}}" 
                class="image-container-wrapper" 
                style="{{item.imageStyle}}" 
                catch:tap="handlePreview" 
                data-src="{{item.imageUrls[0]}}"
                data-original-image-urls="{{item.originalImageUrls || item.imageUrls}}">

            <!-- å•å¼ å›¾ç‰‡ -->
            <block wx:if="{{item.imageUrls.length === 1}}">
              <image
                id="single-image-{{item.postId}}"
                class="post-image"
                src="{{item.imageUrls[0]}}"
                mode="aspectFill"
                lazy-load="{{true}}"
                binderror="onImageError"
                bindload="onImageLoad"
                data-postid="{{item.postId}}"
                data-postindex="{{index}}"
                data-imgindex="0"
                data-type="single"
              />
            </block>

            <!-- å¤šå¼ å›¾ç‰‡ -->
            <block wx:elif="{{item.imageUrls.length > 1}}">
              <swiper id="swiper-{{item.postId}}" class="image-swiper" indicator-dots="true" circular="true" style="height: {{swiperHeights[index] ? swiperHeights[index] + 'px' : '220px'}};">
                <block wx:for="{{item.imageUrls}}" wx:for-item="img" wx:key="*this" wx:for-index="imgindex">
                  <swiper-item>
                    <image
                      class="post-image"
                      src="{{img}}"
                      mode="aspectFill"
                      lazy-load="{{true}}"
                      binderror="onImageError"
                      bindload="onImageLoad"
                      catch:tap="handlePreview"
                      data-src="{{img}}"
                      data-original-image-urls="{{item.originalImageUrls || item.imageUrls}}"
                      data-postid="{{item.postId}}"
                      data-postindex="{{index}}"
                      data-imgindex="{{imgindex}}"
                      data-type="multi"
                    />
                  </swiper-item>
                </block>
              </swiper>
            </block>
          </view>
            
          <view class="post-content" wx:if="{{item.postContent}}" style="white-space: pre-wrap;">{{item.postContent}}</view>
          
          <!-- æ ‡ç­¾æ˜¾ç¤º -->
          <view wx:if="{{item.postTags && item.postTags.length > 0}}" class="post-tags">
            <text wx:for="{{item.postTags}}" wx:key="index" 
                  class="post-tag" 
                  catchtap="onTagClick" 
                  data-tag="{{item}}">#{{item}}</text>
          </view>
        </view>
      </navigator>

      <!-- å–æ¶ˆæ”¶è—æŒ‰é’®åŒºåŸŸ -->
      <view class="delete-section">
        <view class="time-left">
          <text class="favorite-time">æ”¶è—äº {{item.formattedCreateTime || 'æœªçŸ¥æ—¶é—´'}}</text>
        </view>
        <view class="button-group">
          <button class="remove-favorite-btn" size="mini" catch:tap="removeFavorite" data-favorite-id="{{item._id}}" data-index="{{index}}">å–æ¶ˆæ”¶è—</button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-container">
    <view class="empty-icon">ğŸ“–</view>
    <view class="empty-text">æ”¶è—å¤¹æ˜¯ç©ºçš„</view>
    <view class="empty-subtext">å»å‘ç°ä¸€äº›å¥½è¯—æ”¶è—èµ·æ¥å§</view>
    <button bindtap="manualLoad" style="margin-top: 20rpx; padding: 15rpx 30rpx; background: #07c160; color: white; border-radius: 8rpx; font-size: 26rpx;">åˆ·æ–°</button>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{favorites.length > 0 && isLoading}}" class="loading-more">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view wx:if="{{favorites.length > 0 && !hasMore && !isLoading}}" class="no-more">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>
