<!--pages/favorite-content/favorite-content.wxml-->
<view class="container">
  <!-- åˆå§‹åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading && favorites.length === 0}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- æ”¶è—å†…å®¹åˆ—è¡¨ -->
  <view wx:elif="{{favorites.length > 0}}" class="favorites-container">
    <view class="favorite-item" 
          wx:for="{{favorites}}" 
          wx:key="_id"
          data-post-id="{{item.postId}}"
          data-favorite-id="{{item._id}}"
          data-post-title="{{item.postTitle}}"
          bindtap="onFavoriteTap"
          bindlongpress="onFavoriteLongPress">
      
      <!-- ä½œè€…ä¿¡æ¯ -->
      <view class="author-info">
        <image wx:if="{{item.postAuthorAvatar}}" 
               class="author-avatar" 
               src="{{item.postAuthorAvatar}}" 
               mode="aspectFill" />
        <view class="author-details">
          <view class="author-name">{{item.postAuthorName}}</view>
          <view class="post-time">{{item.formattedPostCreateTime}}</view>
        </view>
      </view>

      <!-- æ ‡é¢˜ -->
      <view wx:if="{{item.postTitle}}" class="post-title">{{item.postTitle}}</view>

      <!-- å†…å®¹ -->
      <view wx:if="{{item.postContent}}" class="post-content" style="white-space: pre-wrap;">{{item.postContent}}</view>

      <!-- å›¾ç‰‡æ˜¾ç¤ºé€»è¾‘ï¼ˆè¿ç§»è‡ªç‚¹èµé¡µé¢ï¼Œæ”¯æŒå•å›¾ç˜¦é«˜å›¾é’³åˆ¶å’Œå¤šå›¾swiperé«˜åº¦ï¼‰ -->
      <view wx:if="{{(item.postImageUrl || (item.postImageUrls && item.postImageUrls.length > 0))}}" class="image-container" id="image-container-{{index}}">
        <!-- å•å¼ å›¾ç‰‡ -->
        <block wx:if="{{item.postImageUrls && item.postImageUrls.length === 1}}">
          <image
            id="single-image-{{item.postId}}"
            src="{{item.postImageUrls[0]}}"
            mode="{{imageClampHeights[item.postId] ? 'aspectFill' : 'widthFix'}}"
            style="width: 100%; height: {{imageClampHeights[item.postId] ? imageClampHeights[item.postId] + 'px' : 'auto'}}; object-fit: {{imageClampHeights[item.postId] ? 'cover' : 'contain'}}; background-color: #f0f0f0;"
            bindload="onImageLoad"
            data-postid="{{item.postId}}"
            data-type="single"
            binderror="onImageError"
            catch:tap="handlePreview"
            data-src="{{item.postImageUrls[0]}}"
            data-original-image-urls="{{item.postImageUrls}}"
            lazy-load="{{true}}"
          />
        </block>
        <!-- å¤šå¼ å›¾ç‰‡ -->
        <block wx:elif="{{item.postImageUrls && item.postImageUrls.length > 1}}">
          <swiper id="swiper-{{item.postId}}" class="image-swiper" indicator-dots="true" circular="true" style="width: 100%; height: {{swiperHeights[index] ? swiperHeights[index] + 'px' : '220px'}};">
            <block wx:for="{{item.postImageUrls}}" wx:for-item="img" wx:for-index="imgindex">
              <swiper-item>
                <image
                  src="{{img}}"
                  mode="aspectFill"
                  bindload="onImageLoad"
                  data-postid="{{item.postId}}"
                  data-postindex="{{index}}"
                  data-imgindex="{{imgindex}}"
                  data-type="multi"
                  binderror="onImageError"
                  catch:tap="handlePreview"
                  data-src="{{img}}"
                  data-original-image-urls="{{item.postImageUrls}}"
                  lazy-load="{{true}}"
                  style="width: 100%; height: 100%; object-fit: cover; background-color: #f0f0f0;"
                />
              </swiper-item>
            </block>
          </swiper>
        </block>
      </view>

      <!-- æ”¶è—æ—¶é—´ -->
      <view class="favorite-time">
        <text class="favorite-label">æ”¶è—äº</text>
        <text class="favorite-date">{{item.formattedCreateTime}}</text>
      </view>

      <!-- è¯—æ­Œæ ‡è¯† -->
      <view wx:if="{{item.postIsPoem}}" class="poem-badge">
        <text wx:if="{{item.postIsOriginal}}">åŸåˆ›è¯—æ­Œ</text>
        <text wx:else>ç»å…¸è¯—æ­Œ</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty-container">
    <view class="empty-icon">ğŸ“–</view>
    <view class="empty-text">æ”¶è—å¤¹æ˜¯ç©ºçš„</view>
    <view class="empty-subtext">å»å‘ç°ä¸€äº›å¥½è¯—æ”¶è—èµ·æ¥å§</view>
    <button bindtap="manualLoad" style="margin-top: 20rpx; padding: 15rpx 30rpx; background: #07c160; color: white; border-radius: 8rpx; font-size: 26rpx;">åˆ·æ–°</button>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{favorites.length > 0 && isLoading}}" class="loading-more">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view wx:if="{{favorites.length > 0 && !hasMore && !isLoading}}" class="no-more">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>
