<!-- pages/add/add.wxml -->
<view class="container">

<!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
<view wx:if="{{imageList.length > 0}}" class="image-section">
  <scroll-view class="image-preview-scroll" scroll-x="true" show-scrollbar="false">
    <view class="image-preview-container">
      <view wx:for="{{imageList}}" wx:key="index" class="image-preview-item">
        <image class="preview-image" src="{{item.previewUrl}}" mode="aspectFill" binderror="onImageError"></image>
        <view class="image-remove-btn" bindtap="removeImage" data-index="{{index}}">Ã—</view>
      </view>
      <view wx:if="{{imageList.length < maxImageCount}}" class="add-image-btn" bindtap="handleChooseImage">
        <view class="add-icon">+</view>
      </view>
    </view>
  </scroll-view>
</view>

<!-- å†…å®¹è¾“å…¥åŒºåŸŸ -->
<view class="content-section">
  <!-- æ ‡é¢˜è¾“å…¥æ¡† -->
  <view class="title-input-wrapper">
    <input 
      class="title-input" 
      placeholder="æ ‡é¢˜" 
      bindinput="onTitleInput"
      maxlength="50"
      value="{{title}}"
    />
  </view>

  <!-- ä½œè€…è¾“å…¥åŒºåŸŸï¼ˆè¯—æ­Œæ¨¡å¼æ˜¾ç¤ºï¼‰ -->
  <view wx:if="{{publishMode === 'poem'}}" class="author-input-wrapper">
    <input 
      class="author-input" 
      placeholder="{{isOriginal ? 'ä½œè€…ï¼ˆå¯é€‰ï¼Œä¸å¡«é»˜è®¤ä½¿ç”¨æ‚¨çš„æ˜µç§°ï¼‰' : 'ä½œè€…ï¼ˆå¿…å¡«ï¼‰'}}" 
      bindinput="onAuthorInput"
      maxlength="20"
      value="{{author}}"
    />
  </view>

  <!-- æ­£æ–‡è¾“å…¥åŒºåŸŸ -->
  <view class="content-input-wrapper">
    <scroll-view 
      class="content-scroll" 
      scroll-y="true"
      enhanced="{{true}}"
      show-scrollbar="{{false}}"
      keyboard-up-adjust="{{true}}"
      hold-keyboard="{{true}}"
    >
      <textarea 
        class="content-textarea" 
        placeholder="æ­¤åˆ»ä½ æƒ³è¦åˆ†äº«..." 
        bindinput="onContentInput"
        maxlength="1500"
        value="{{content}}"
        auto-height="{{true}}"
        show-confirm-bar="{{false}}"
        adjust-position="{{false}}"
        cursor-spacing="50"
        fixed="{{true}}"
      ></textarea>
    </scroll-view>
    <view class="char-count">{{content.length}}/1500</view>
  </view>
</view>

<!-- å†™è¯—å­èœå• -->
<view wx:if="{{showPoemSubmenu}}" class="poem-submenu">
  <view class="submenu-item" bindtap="selectPoemMode" data-original="true">
    <view class="submenu-icon">âœ¨</view>
    <view class="submenu-text">åŸåˆ›</view>
  </view>
  <view class="submenu-item" bindtap="selectPoemMode" data-original="false">
    <view class="submenu-icon">ğŸ“–</view>
    <view class="submenu-text">éåŸåˆ›</view>
  </view>
</view>

<!-- åº•éƒ¨å·¥å…·æ  -->
<view class="toolbar">
  <view class="toolbar-item" bindtap="handleChooseImage">
    <view class="toolbar-icon">ğŸ“·</view>
    <view class="toolbar-text">å›¾ç‰‡</view>
  </view>
  <view class="toolbar-item" bindtap="toggleTagSelector">
    <view class="toolbar-icon">#</view>
    <view class="toolbar-text">æ ‡ç­¾</view>
  </view>
  <view class="toolbar-item" bindtap="switchMode">
    <view class="toolbar-icon">{{publishMode === 'normal' ? 'ğŸ“' : 'ğŸ­'}}</view>
    <view class="toolbar-text">{{publishMode === 'normal' ? 'å†™è¯—' : 'æ™®é€š'}}</view>
  </view>
  <view class="publish-btn {{canPublish ? 'active' : ''}}" bindtap="submitPost">å‘å¸ƒ</view>
</view>

<!-- æ ‡ç­¾é€‰æ‹©åŒºåŸŸ -->
<view wx:if="{{showTagSelector}}" class="tag-section">
  <view class="tag-header">
    <text class="tag-title">æ·»åŠ æ ‡ç­¾</text>
    <text class="tag-count">{{selectedTags.length}}/5</text>
    <text class="tag-toggle" bindtap="toggleTagSelector">æ”¶èµ·</text>
  </view>
  
  <!-- å·²é€‰æ ‡ç­¾æ˜¾ç¤º -->
  <view wx:if="{{selectedTags.length > 0}}" class="selected-tags">
    <view wx:for="{{selectedTags}}" wx:key="index" class="selected-tag">
      <text>{{item}}</text>
      <text class="remove-tag" bindtap="removeTag" data-tag="{{item}}">Ã—</text>
    </view>
  </view>
  
  <!-- æ ‡ç­¾é€‰æ‹©å™¨ -->
  <view wx:if="{{showTagSelector}}" class="tag-selector">
    <!-- åˆ†ç±»é€‰æ‹©å™¨ -->
    <view class="category-selector">
      <scroll-view class="category-scroll" scroll-x="true" show-scrollbar="false">
        <view class="category-list">
          <view wx:for="{{tagCategories}}" wx:key="index" 
                class="category-item {{currentCategoryIndex === index ? 'active' : ''}}"
                bindtap="switchCategory" data-index="{{index}}">
            <text class="category-icon">{{item.icon}}</text>
            <text class="category-name">{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
    
    <!-- å½“å‰åˆ†ç±»çš„æ ‡ç­¾ -->
    <view class="current-category-tags">
      <view wx:for="{{tagCategories[currentCategoryIndex].tags}}" wx:key="index" 
            class="preset-tag {{selectedTags.includes(item) ? 'selected' : ''}}"
            bindtap="selectTag" data-tag="{{item}}">
        {{item}}
      </view>
    </view>
    
    <!-- è‡ªå®šä¹‰æ ‡ç­¾è¾“å…¥ -->
    <view class="custom-tag-input">
      <input placeholder="è¾“å…¥è‡ªå®šä¹‰æ ‡ç­¾" 
             value="{{customTag}}" 
             bindinput="onCustomTagInput"
             maxlength="10" />
      <button size="mini" bindtap="addCustomTag">æ·»åŠ </button>
    </view>
    
    <!-- åŒ¹é…çš„æ ‡ç­¾æ¨è -->
    <view wx:if="{{showMatchedTags && matchedTags.length > 0}}" class="matched-tags">
      <view class="matched-tags-title">æ¨èæ ‡ç­¾ï¼š</view>
      <view class="matched-tags-list">
        <view wx:for="{{matchedTags}}" wx:key="index" 
              class="matched-tag" 
              bindtap="selectMatchedTag" 
              data-tag="{{item}}">
          {{item}}
        </view>
      </view>
    </view>
  </view>
</view>


</view> <!-- è¿™ä¸ª </view> æ˜¯ç”¨æ¥é—­åˆæœ€å¤–å±‚çš„ <view class="container"> çš„ -->