<!-- pages/add/add.wxml -->
<view class="container">

<!-- 图片预览区域 -->
<view wx:if="{{imageList.length > 0}}" class="image-section">
  <scroll-view class="image-preview-scroll" scroll-x="true" show-scrollbar="false">
    <view class="image-preview-container">
      <view wx:for="{{imageList}}" wx:key="index" class="image-preview-item">
        <image class="preview-image" src="{{item.previewUrl}}" mode="aspectFill" binderror="onImageError"></image>
        <view class="image-remove-btn" bindtap="removeImage" data-index="{{index}}">×</view>
      </view>
      <view wx:if="{{imageList.length < maxImageCount}}" class="add-image-btn" bindtap="handleChooseImage">
        <view class="add-icon">+</view>
      </view>
    </view>
  </scroll-view>
</view>

<!-- 内容输入区域 -->
<view class="content-section">
  <!-- 标题输入框 -->
  <view class="title-input-wrapper">
    <input 
      class="title-input" 
      placeholder="标题" 
      bindinput="onTitleInput"
      maxlength="50"
      value="{{title}}"
    />
  </view>

  <!-- 作者输入区域（诗歌模式显示） -->
  <view wx:if="{{publishMode === 'poem'}}" class="author-input-wrapper">
    <input 
      class="author-input" 
      placeholder="{{isOriginal ? '作者（可选，不填默认使用您的昵称）' : '作者（必填）'}}" 
      bindinput="onAuthorInput"
      maxlength="20"
      value="{{author}}"
    />
  </view>

  <!-- 正文输入区域 -->
  <view class="content-input-wrapper">
    <scroll-view 
      class="content-scroll" 
      scroll-y="true"
      enhanced="{{true}}"
      show-scrollbar="{{false}}"
      keyboard-up-adjust="{{true}}"
      hold-keyboard="{{true}}"
    >
      <textarea 
        class="content-textarea" 
        placeholder="此刻你想要分享..." 
        bindinput="onContentInput"
        maxlength="1500"
        value="{{content}}"
        auto-height="{{true}}"
        show-confirm-bar="{{false}}"
        adjust-position="{{false}}"
        cursor-spacing="50"
        fixed="{{true}}"
      ></textarea>
    </scroll-view>
    <view class="char-count">{{content.length}}/1500</view>
  </view>
</view>

<!-- 写诗子菜单 -->
<view wx:if="{{showPoemSubmenu}}" class="poem-submenu">
  <view class="submenu-item" bindtap="selectPoemMode" data-original="true">
    <view class="submenu-icon">✨</view>
    <view class="submenu-text">原创</view>
  </view>
  <view class="submenu-item" bindtap="selectPoemMode" data-original="false">
    <view class="submenu-icon">📖</view>
    <view class="submenu-text">非原创</view>
  </view>
</view>

<!-- 底部工具栏 -->
<view class="toolbar">
  <view class="toolbar-item" bindtap="handleChooseImage">
    <view class="toolbar-icon">📷</view>
    <view class="toolbar-text">图片</view>
  </view>
  <view class="toolbar-item" bindtap="toggleTagSelector">
    <view class="toolbar-icon">#</view>
    <view class="toolbar-text">标签</view>
  </view>
  <view class="toolbar-item" bindtap="switchMode">
    <view class="toolbar-icon">{{publishMode === 'normal' ? '📝' : '🎭'}}</view>
    <view class="toolbar-text">{{publishMode === 'normal' ? '写诗' : '普通'}}</view>
  </view>
  <view class="publish-btn {{canPublish ? 'active' : ''}}" bindtap="submitPost">发布</view>
</view>

<!-- 标签选择区域 -->
<view wx:if="{{showTagSelector}}" class="tag-section">
  <view class="tag-header">
    <text class="tag-title">添加标签</text>
    <text class="tag-count">{{selectedTags.length}}/5</text>
    <text class="tag-toggle" bindtap="toggleTagSelector">收起</text>
  </view>
  
  <!-- 已选标签显示 -->
  <view wx:if="{{selectedTags.length > 0}}" class="selected-tags">
    <view wx:for="{{selectedTags}}" wx:key="index" class="selected-tag">
      <text>{{item}}</text>
      <text class="remove-tag" bindtap="removeTag" data-tag="{{item}}">×</text>
    </view>
  </view>
  
  <!-- 标签选择器 -->
  <view wx:if="{{showTagSelector}}" class="tag-selector">
    <!-- 分类选择器 -->
    <view class="category-selector">
      <scroll-view class="category-scroll" scroll-x="true" show-scrollbar="false">
        <view class="category-list">
          <view wx:for="{{tagCategories}}" wx:key="index" 
                class="category-item {{currentCategoryIndex === index ? 'active' : ''}}"
                bindtap="switchCategory" data-index="{{index}}">
            <text class="category-icon">{{item.icon}}</text>
            <text class="category-name">{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
    
    <!-- 当前分类的标签 -->
    <view class="current-category-tags">
      <view wx:for="{{tagCategories[currentCategoryIndex].tags}}" wx:key="index" 
            class="preset-tag {{selectedTags.includes(item) ? 'selected' : ''}}"
            bindtap="selectTag" data-tag="{{item}}">
        {{item}}
      </view>
    </view>
    
    <!-- 自定义标签输入 -->
    <view class="custom-tag-input">
      <input placeholder="输入自定义标签" 
             value="{{customTag}}" 
             bindinput="onCustomTagInput"
             maxlength="10" />
      <button size="mini" bindtap="addCustomTag">添加</button>
    </view>
    
    <!-- 匹配的标签推荐 -->
    <view wx:if="{{showMatchedTags && matchedTags.length > 0}}" class="matched-tags">
      <view class="matched-tags-title">推荐标签：</view>
      <view class="matched-tags-list">
        <view wx:for="{{matchedTags}}" wx:key="index" 
              class="matched-tag" 
              bindtap="selectMatchedTag" 
              data-tag="{{item}}">
          {{item}}
        </view>
      </view>
    </view>
  </view>
</view>


</view> <!-- 这个 </view> 是用来闭合最外层的 <view class="container"> 的 -->