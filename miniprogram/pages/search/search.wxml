<!-- pages/search/search.wxml -->
<view class="container">
  <!-- æœç´¢æ¡† -->
  <view class="search-header">
    <view class="search-input-container">
      <view class="search-icon">ğŸ”</view>
      <input 
        class="search-input" 
        placeholder="æœç´¢å¸–å­..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
        focus="{{true}}"
        confirm-type="search"
      />
      <view wx:if="{{searchKeyword}}" class="clear-btn" bindtap="clearSearch">Ã—</view>
    </view>
    <view class="cancel-btn" bindtap="goBack">å–æ¶ˆ</view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view wx:if="{{searchKeyword && !isSearching && searchResults.length > 0}}" class="search-results">
    <view class="results-header">
      <text class="results-count">æ‰¾åˆ° {{searchResults.length}} ä¸ªç»“æœ</text>
    </view>
    
    <view class="post-list">
      <view 
        wx:for="{{searchResults}}" 
        wx:key="_id" 
        wx:for-index="index"
        class="post-item-wrapper"
      >
        <!-- ä½œè€…ä¿¡æ¯ -->
        <view class="author-info-outside">
          <image wx:if="{{item.authorAvatar}}" 
                 class="author-avatar" 
                 src="{{item.authorAvatar}}" 
                 mode="aspectFill" 
                 binderror="onAvatarError" 
                 catch:tap="navigateToUserProfile" 
                 data-user-id="{{item._openid}}"></image>
          <text class="author-name">{{item.authorName}}</text>
        </view>
        
        <!-- å¸–å­å†…å®¹ -->
        <view class="post-item" bindtap="onPostTap" data-postid="{{item._id}}">
          <view class="post-title">{{item.title}}</view>
          
          <!-- å›¾ç‰‡æ˜¾ç¤º -->
          <view wx:if="{{(item.imageUrls && item.imageUrls.length > 0)}}" 
                class="image-container-wrapper" 
                style="{{item.imageStyle}}"
                catch:tap="handlePreview" 
                data-src="{{item.imageUrls[0]}}"
                data-original-image-urls="{{item.originalImageUrls || item.imageUrls}}">
            
            <!-- å•å¼ å›¾ç‰‡ -->
            <block wx:if="{{item.imageUrls.length === 1}}">
              <image
                class="post-image"
                src="{{item.imageUrls[0]}}"
                mode="aspectFill"
                lazy-load="{{true}}"
                binderror="onImageError"
                catch:tap="handlePreview"
                data-src="{{item.imageUrls[0]}}"
                data-original-image-urls="{{item.originalImageUrls || item.imageUrls}}"
              />
            </block>

            <!-- å¤šå¼ å›¾ç‰‡ -->
            <block wx:elif="{{item.imageUrls.length > 1}}">
              <swiper class="image-swiper" indicator-dots="true" circular="true">
                <block wx:for="{{item.imageUrls}}" wx:for-item="img" wx:key="*this">
                  <swiper-item>
                    <image
                      class="post-image"
                      src="{{img}}"
                      mode="aspectFill"
                      lazy-load="{{true}}"
                      binderror="onImageError"
                      catch:tap="handlePreview"
                      data-src="{{img}}"
                      data-original-image-urls="{{item.originalImageUrls || item.imageUrls}}"
                    />
                  </swiper-item>
                </block>
              </swiper>
            </block>
          </view>
            
          <view class="post-content" wx:if="{{item.content}}" style="white-space: pre-wrap;">{{item.content}}</view>
          
          <!-- æ ‡ç­¾æ˜¾ç¤º -->
          <view wx:if="{{item.tags && item.tags.length > 0}}" class="post-tags">
            <text wx:for="{{item.tags}}" wx:key="index" 
                  class="post-tag" 
                  catchtap="onTagClick" 
                  data-tag="{{item}}">#{{item}}</text>
          </view>
        </view>

        <!-- äº’åŠ¨åŒºåŸŸ -->
        <view class="vote-section">
          <view class="actions-left">
            <!-- å·¦ä¾§ç•™ç©ºï¼Œä¿æŒå¸ƒå±€å¹³è¡¡ -->
          </view>
          <view class="actions-right">
            <view class="action-item" catch:tap="onCommentClick" data-postid="{{item._id}}">
              <text class="action-emoji">ğŸ’¬</text>
              <text class="action-text">{{item.commentCount || 0}}</text>
            </view>
            <view class="action-item">
              <text class="action-text">{{item.votes || 0}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{searchKeyword && !isSearching && searchResults.length === 0}}" class="empty-state">
    <view class="empty-icon">ğŸ”</view>
    <view class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å¸–å­</view>
    <view class="empty-subtext">è¯•è¯•å…¶ä»–å…³é”®è¯å§</view>
  </view>

  <!-- æœç´¢å»ºè®® -->
  <view wx:if="{{!searchKeyword && !isSearching && searchHistory.length > 0}}" class="search-suggestions">
    <view class="suggestions-header">
      <text class="suggestions-title">æœç´¢å†å²</text>
      <text class="clear-history" bindtap="clearHistory">æ¸…ç©º</text>
    </view>
    <view class="suggestions-list">
      <view 
        wx:for="{{searchHistory}}" 
        wx:key="index" 
        class="suggestion-item"
        bindtap="selectHistoryKeyword"
        data-keyword="{{item}}"
      >
        <text class="suggestion-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- çƒ­é—¨æœç´¢ -->
  <view wx:if="{{!searchKeyword && !isSearching && searchHistory.length === 0}}" class="hot-searches">
    <view class="hot-header">
      <text class="hot-title">çƒ­é—¨æœç´¢</text>
    </view>
    <view class="hot-list">
      <view 
        wx:for="{{hotSearches}}" 
        wx:key="index" 
        class="hot-item"
        bindtap="selectHotKeyword"
        data-keyword="{{item}}"
      >
        <text class="hot-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isSearching}}" class="loading-state">
    <view class="loading-text">æœç´¢ä¸­...</view>
  </view>
</view>
