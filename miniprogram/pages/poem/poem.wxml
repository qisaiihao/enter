<!-- poem.wxml - åŸåˆ›è¯—æ­Œé¡µé¢ï¼ˆè·¯ï¼‰ -->
<view class="container">
  <!-- åŒå›¾å±‚æ¸…æ™°èƒŒæ™¯ -->
  <view class="background-wrapper">
    <image 
      wx:for="{{bgLayers}}" 
      wx:key="index" 
      class="bg-image {{item.visible ? 'visible' : ''}}" 
      src="{{item.url}}"
      mode="aspectFill"
      bindload="onBackgroundImageLoad"
      data-layer-index="{{index}}"
    ></image>
  </view>
  <!-- åŒå›¾å±‚æ¨¡ç³ŠèƒŒæ™¯ -->
  <view class="blur-background-wrapper">
    <image 
      wx:for="{{bgLayers}}" 
      wx:key="index" 
      class="bg-image blur-image {{item.visible ? 'visible' : ''}}" 
      src="{{item.url}}"
      mode="aspectFill"
      bindload="onBackgroundImageLoad"
      data-layer-index="{{index}}"
    ></image>
  </view>

  <!-- éª¨æ¶å± -->
  <view wx:if="{{isLoading && postList.length === 0}}" class="skeleton-container">
    <skeleton />
  </view>

  <!-- è·¯æ¨¡å¼ï¼ˆåŸåˆ›è¯—æ­Œï¼‰ -->
  <view wx:if="{{postList.length > 0}}" class="poem-mode-container" bindtouchstart="touchStart" bindtouchend="touchEnd">
    
    <!-- 
      æ ¸å¿ƒæ”¹åŠ¨ï¼š
      ä¸å†ä½¿ç”¨ postList[currentPostIndex]ï¼Œè€Œæ˜¯ä½¿ç”¨ç‹¬ç«‹çš„ currentPost å¯¹è±¡ã€‚
      è¿™æ ·åˆ‡æ¢æ—¶ï¼Œå°ç¨‹åºåªä¼šæ›´æ–° image å’Œ text çš„å†…å®¹ï¼Œè€Œä¸ä¼šé‡æ–°æ¸²æŸ“æ•´ä¸ª view ç»“æ„ã€‚
    -->
    <view class="single-post-content {{isTransitioning ? 'is-transitioning' : ''}}" catchtap="onSinglePostTap" data-postid="{{currentPost._id}}">
      <!-- ä½œè€…ä¿¡æ¯ -->
      <view class="single-author-info">
        <image wx:if="{{currentPost.authorAvatar}}" class="single-author-avatar" src="{{currentPost.authorAvatar}}" mode="aspectFill" />
        <text class="single-author-name">{{currentPost.authorName}}</text>
      </view>
      
      <!-- æ ‡é¢˜ -->
      <view class="single-post-title" wx:if="{{currentPost.title}}">{{currentPost.title}}</view>
      <!-- è¯—æ­Œä½œè€…ä¿¡æ¯ -->
      <view wx:if="{{currentPost.isPoem}}" class="single-poem-author">{{currentPost.author || currentPost.authorName}}</view>
      
      <!-- å†…å®¹ -->
      <view class="single-post-content-text" wx:if="{{currentPost.content}}" style="white-space: pre-wrap;">{{currentPost.content}}</view>
      
    </view>
    
    <view wx:if="{{postList.length === 0 && !isLoading}}" class="empty-state">
      <view class="empty-icon">ğŸ›¤ï¸</view>
      <view class="empty-text">è¿˜æ²¡æœ‰è·¯è¯—å“¦ï½</view>
      <view class="empty-subtext">å¿«å»å¹¿åœºå‘ç°åŸåˆ›å¥½è¯—å§ï¼</view>
    </view>
  </view>


  <!-- è°ƒè¯•æŒ‰é’® (ä»…åœ¨å¼€å‘ç¯å¢ƒæ˜¾ç¤º) -->
  <view wx:if="{{false}}" class="debug-button" bindtap="testImageUrls">
    <view>ğŸ›</view>
  </view>

  
</view>

<!-- è‡ªå®šä¹‰tabBar -->
<custom-tabbar />