<!--pages/user-profile/user-profile.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading && userPosts.length === 0}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- ä¸»å†…å®¹ -->
  <view wx:else>
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="profile-card">
      <view class="profile-avatar">
        <image src="{{userInfo.avatarUrl || '../../images/avatar.png'}}" mode="aspectFill" binderror="onAvatarError"></image>
      </view>
      <view class="profile-info">
        <text class="profile-name">{{userInfo.nickName || 'å¾®ä¿¡ç”¨æˆ·'}}</text>
        <text class="profile-bio">{{userInfo.bio || 'è¿™ä¸ªç”¨æˆ·å¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½è¿˜æ²¡ç•™ä¸‹...'}}</text>
      </view>
    </view>

    <!-- å¸–å­åˆ—è¡¨ -->
    <view class="posts-section">
      <view class="section-title">TAçš„å¸–å­</view>
      <block wx:if="{{userPosts.length > 0}}">
        <view wx:for="{{userPosts}}" wx:key="_id" class="post-card" bind:tap="navigateToPostDetail" data-id="{{item._id}}" hover-class="post-item-active">
          <view class="post-header">
            <text class="post-title">{{item.title}}</text>
          </view>
          
          <!-- å›¾ç‰‡æ˜¾ç¤º -->
          <view class="image-container" wx:if="{{item.imageUrls && item.imageUrls.length > 0}}">
            <!-- å¤šå›¾è½®æ’­ -->
            <block wx:if="{{item.imageUrls.length > 1}}">
              <swiper id="user-swiper-{{index}}" class="image-swiper" indicator-dots="true" circular="false" autoplay="false" style="width: 100%; height: {{swiperHeights[index] ? swiperHeights[index] + 'px' : '220px'}};">
                <block wx:for="{{item.imageUrls}}" wx:for-item="imageUrl" wx:key="*this" wx:for-index="imgindex">
                  <swiper-item>
                    <image
                      id="user-swiper-img-{{index}}-{{imgindex}}"
                      class="post-image"
                      src="{{imageUrl}}"
                      mode="aspectFill"
                      catch:tap="handlePreview"
                      data-src="{{imageUrl}}"
                      data-original-image-urls="{{item.originalImageUrls || item.imageUrls}}"
                      binderror="onImageError"
                      bindload="onImageLoad"
                      data-postindex="{{index}}"
                      data-imgindex="{{imgindex}}"
                      data-type="multi"
                      lazy-load="{{true}}"
                      style="width: 100%; height: 100%; object-fit: cover; background-color: #f0f0f0;"
                    ></image>
                  </swiper-item>
                </block>
              </swiper>
            </block>
            
            <!-- å•å›¾ -->
            <block wx:elif="{{item.imageUrls.length === 1}}">
              <image
                id="user-single-img-{{index}}"
                class="post-image"
                src="{{item.imageUrls[0]}}"
                mode="{{imageClampHeights[index] ? 'aspectFill' : 'widthFix'}}"
                catch:tap="handlePreview"
                data-src="{{item.imageUrls[0]}}"
                data-original-image-urls="{{item.originalImageUrls || item.imageUrls}}"
                binderror="onImageError"
                bindload="onImageLoad"
                data-postindex="{{index}}"
                data-imgindex="0"
                data-type="single"
                lazy-load="{{true}}"
                style="width: 100%; height: {{imageClampHeights[index] ? imageClampHeights[index] + 'px' : 'auto'}}; object-fit: {{imageClampHeights[index] ? 'cover' : 'contain'}}; background-color: #f0f0f0;"
              ></image>
            </block>
          </view>
          
          <view class="post-content" wx:if="{{item.content}}">{{item.content}}</view>
          
          <!-- å¸–å­ä¿¡æ¯ -->
          <view class="post-footer">
            <view class="post-stats">
              <text class="stat-item">ğŸ‘ {{item.votes || 0}}</text>
              <text class="stat-item">ğŸ’¬ {{item.commentCount || 0}}</text>
            </view>
            <view class="post-time">{{item.formattedCreateTime}}</view>
          </view>
        </view>
        
        <!-- åŠ è½½æ›´å¤šæç¤º -->
        <view wx:if="{{isLoading && userPosts.length > 0}}" class="loading-container">
          <view class="loading-text">åŠ è½½ä¸­...</view>
        </view>
        
        <!-- å ä½ç©ºç™½ï¼Œä¾¿äºè§¦å‘ onReachBottom -->
        <view style="height: 200rpx;"></view>
      </block>
      
      <view wx:else class="empty-tip">
        <text>TAè¿˜æ²¡æœ‰å‘å¸ƒè¿‡å¸–å­</text>
      </view>
    </view>
  </view>
</view>
