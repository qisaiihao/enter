<!-- components/poem-card/poem-card.wxml -->
<view class="poem-card-wrapper {{computedPost.isOriginal ? 'original-post' : ''}} {{mode === 'detail' ? 'detail-mode' : ''}} {{mode === 'immersive' ? 'immersive-mode' : ''}}">
  
  <!-- ä½œè€…ä¿¡æ¯ -->
  <view class="author-info-outside">
    <image 
      wx:if="{{computedPost.authorAvatar}}" 
      class="author-avatar" 
      src="{{computedPost.authorAvatar}}" 
      mode="aspectFill" 
      binderror="onAvatarError" 
      catch:tap="navigateToUserProfile" 
      data-user-id="{{computedPost._openid}}"
    />
    <text class="author-name">{{computedPost.authorName}}</text>
  </view>
  
  <!-- å¯ç‚¹å‡»çš„å†…å®¹åŒºåŸŸ - è·³è½¬åˆ°è¯¦æƒ…é¡µ -->
  <navigator 
    wx:if="{{mode !== 'detail'}}"
    class="poem-card-navigator"
    url="/pages/post-detail/post-detail?id={{computedPost._id}}"
    hover-class="navigator-hover"
  >
    <view class="poem-card-content">
      <view class="poem-card-title">{{computedPost.title}}</view>
      <!-- è¯—æ­Œä½œè€…ä¿¡æ¯ -->
      <view wx:if="{{computedPost.isPoem && computedPost.author}}" class="poem-author">{{computedPost.author}}</view>
      
      <!-- å›¾ç‰‡æ˜¾ç¤ºé€»è¾‘ (ä»…åˆ—è¡¨å’Œè¯¦æƒ…æ¨¡å¼) -->
      <view wx:if="{{mode !== 'immersive' && (computedPost.imageUrls && computedPost.imageUrls.length > 0)}}" 
            class="image-container-wrapper" 
            style="{{computedPost.imageStyle}}" 
            catch:tap="handlePreview" 
            data-src="{{computedPost.imageUrls[0]}}"
            data-original-image-urls="{{computedPost.originalImageUrls || computedPost.imageUrls}}">

        <!-- å•å¼ å›¾ç‰‡ -->
        <block wx:if="{{computedPost.imageUrls.length === 1}}">
          <image
            class="post-image"
            src="{{computedPost.imageUrls[0]}}"
            mode="aspectFill"
            lazy-load="{{true}}"
            binderror="onImageError"
          />
        </block>

        <!-- å¤šå¼ å›¾ç‰‡ -->
        <block wx:elif="{{computedPost.imageUrls.length > 1}}">
          <swiper class="image-swiper" indicator-dots="true" circular="true">
            <block wx:for="{{computedPost.imageUrls}}" wx:for-item="img" wx:key="*this">
              <swiper-item>
                <image
                  class="post-image"
                  src="{{img}}"
                  mode="aspectFill"
                  lazy-load="{{true}}"
                  binderror="onImageError"
                  catch:tap="handlePreview"
                  data-src="{{img}}"
                  data-original-image-urls="{{computedPost.originalImageUrls || computedPost.imageUrls}}"
                />
              </swiper-item>
            </block>
          </swiper>
        </block>
      </view>
        
      <view class="poem-card-content-text" wx:if="{{computedPost.content}}" style="white-space: pre-wrap;">{{computedPost.content}}</view>
      
      <!-- æ ‡ç­¾æ˜¾ç¤º -->
      <view wx:if="{{computedPost.tags && computedPost.tags.length > 0}}" class="post-tags">
        <text wx:for="{{computedPost.tags}}" wx:key="index" 
              class="post-tag" 
              catch:tap="onTagClick" 
              data-tag="{{item}}">#{{item}}</text>
      </view>
    </view>
  </navigator>
  
  <!-- è¯¦æƒ…é¡µæ¨¡å¼ï¼šä¸åŒ…è£…navigator -->
  <view wx:else class="poem-card-content">
    <view class="poem-card-title">{{computedPost.title}}</view>
    <!-- è¯—æ­Œä½œè€…ä¿¡æ¯ -->
    <view wx:if="{{computedPost.isPoem && computedPost.author}}" class="poem-author">{{computedPost.author}}</view>
    
    <!-- å›¾ç‰‡æ˜¾ç¤ºé€»è¾‘ -->
    <view wx:if="{{(computedPost.imageUrls && computedPost.imageUrls.length > 0)}}" 
          class="image-container-wrapper" 
          style="{{computedPost.imageStyle}}" 
          catch:tap="handlePreview" 
          data-src="{{computedPost.imageUrls[0]}}"
          data-original-image-urls="{{computedPost.originalImageUrls || computedPost.imageUrls}}">

      <!-- å•å¼ å›¾ç‰‡ -->
      <block wx:if="{{computedPost.imageUrls.length === 1}}">
        <image
          class="post-image"
          src="{{computedPost.imageUrls[0]}}"
          mode="aspectFill"
          lazy-load="{{true}}"
          binderror="onImageError"
        />
      </block>

      <!-- å¤šå¼ å›¾ç‰‡ -->
      <block wx:elif="{{computedPost.imageUrls.length > 1}}">
        <swiper class="image-swiper" indicator-dots="true" circular="true">
          <block wx:for="{{computedPost.imageUrls}}" wx:for-item="img" wx:key="*this">
            <swiper-item>
              <image
                class="post-image"
                src="{{img}}"
                mode="aspectFill"
                lazy-load="{{true}}"
                binderror="onImageError"
                catch:tap="handlePreview"
                data-src="{{img}}"
                data-original-image-urls="{{computedPost.originalImageUrls || computedPost.imageUrls}}"
              />
            </swiper-item>
          </block>
        </swiper>
      </block>
    </view>
      
    <view class="poem-card-content-text" wx:if="{{computedPost.content}}" style="white-space: pre-wrap;">{{computedPost.content}}</view>
    
    <!-- æ ‡ç­¾æ˜¾ç¤º -->
    <view wx:if="{{computedPost.tags && computedPost.tags.length > 0}}" class="post-tags">
      <text wx:for="{{computedPost.tags}}" wx:key="index" 
            class="post-tag" 
            catch:tap="onTagClick" 
            data-tag="{{item}}">#{{item}}</text>
    </view>
  </view>

  <!-- æ²‰æµ¸å¼æ¨¡å¼ï¼šåªæ˜¾ç¤ºæ–‡å­—å†…å®¹ -->
  <view wx:if="{{mode === 'immersive'}}" class="poem-card-content">
    <view class="poem-card-title" wx:if="{{computedPost.title}}">{{computedPost.title}}</view>
    <!-- è¯—æ­Œä½œè€…ä¿¡æ¯ -->
    <view wx:if="{{computedPost.isPoem}}" class="poem-author">{{computedPost.author || computedPost.authorName}}</view>
    
    <!-- å†…å®¹ -->
    <view class="poem-card-content-text" wx:if="{{computedPost.content}}" style="white-space: pre-wrap;">{{computedPost.content}}</view>
  </view>

  <!-- ç‹¬ç«‹çš„äº’åŠ¨åŒºåŸŸ - ä¸è§¦å‘è¯¦æƒ…é¡µè·³è½¬ (ä»…åˆ—è¡¨æ¨¡å¼) -->
  <view wx:if="{{mode === 'list' && showInteractions}}" class="vote-section">
    <view class="actions-left">
      <!-- å·¦ä¾§ç•™ç©ºï¼Œä¿æŒå¸ƒå±€å¹³è¡¡ -->
    </view>
    <view class="button-group">
      <view class="comment-count" catch:tap="onCommentClick" data-postid="{{computedPost._id}}">
        <text class="action-emoji">ðŸ’¬</text>
        <text class="action-text">{{computedPost.commentCount || 0}}</text>
      </view>
      <view class="like-icon-container" catch:tap="onVote" data-postid="{{computedPost._id}}" data-index="{{index}}">
        <image class="like-icon" src="{{computedPost.likeIcon || '/images/seed.png'}}" mode="aspectFit" binderror="onLikeIconError"></image>
      </view>
      <view class="vote-count {{computedPost.isVoted ? 'voted' : ''}}">
        <text class="action-text">{{computedPost.votes || 0}}</text>
      </view>
    </view>
  </view>
</view>

